# Simulation Setup Guide

[Back..](../README.md#api-documentation)

This guide outlines the process of setting up simulations in a way that balances user modifiability and subcomponent integration requirements. The setup focuses on four key data structures: `userStruct`, `compStruct`, `simIn`, and `simPar`. These structures are designed to maintain consistency across subsystems, avoiding conflicts and ensuring similar code structure.

## Key Structures

The following structures should be used in order:

1. **`userStruct`**
2. **`compStruct`**
3. **`SimIn`**
4. **`SimPar`**

Each structure should have identical field structures to allow for consistent value referencing by simply changing the top-level structure name. 
These structures should mirror the Simulink block diagram levels so that top-level blocks correspond to the appropriate place in the structure.

## Structure Details

### `userStruct`

- **Scope**: Primary interface for users to change simulation behavior
- **Purpose**: Contains essential pre-setup values necessary for simulation configuration
- **Usage**: Prefer using these values over modifying parameters post-setup to ensure consistent initial conditions (e.g., determining the initial pitch angle from an initial velocity)

#### Fields
- **Top Level**: Simulink information
  - `info`: Not user-editable
  - `model_params`: Simulink configuration details (model explorer)
  - `simulation_defaults`: Variables used in Simulink blocks
  - `variants`: Simulink variants
  - `types`: Toggle options without defining variants
  - `outputFunc`: File name for output bus definition

#### Requirements
- Assign all values before creating `SimIn`
- Check existing field values and use them if available; otherwise, assign default values
- Do not edit after `SimIn` initialization

**[Detailed userStruct Info](./SETUP.MD )**

### `compStruct`

- **Scope**: Internal use only. Not for user interaction
- **Purpose**: Derived from `userStruct`, assigned before creating `SimIn`
- **Usage**: Populate fields when it's convenient to execute code simultaneously during the `userStruct` setup process (e.g., computing initial conditions for trajectories). Used to pass information between functions, when the information is not user facing or modifiable

#### Requirements
- Assign values based on `userStruct`
- Do not edit after `SimIn` initialization

### `SimIn`

- **Scope**: Secondary interface for users to change simulation behavior that is not superseded by `SimPar`
- **Purpose**: Contains values used to be included in `SimPar` or directly called by simulation blocks/configuration menus
- **Usage**: Partially defines a Simulink run but may not capture the entire Simulink environment configuration required in the user workspace (e.g., bus objects, `SimPar` values)
**[Simulink Locations Where SimIn is Used in BAM](./SimIn/BAMSimIn.md )**

#### Structure
- Corresponds with Simulink diagram levels (e.g., `SimIn.Environment` for environment block parameters)

#### Requirements
- Only include values used by a simulation block or in `simPar`


### `SimPar`

- **Scope**: Secondary interface for users to change simulation behavior
- **Purpose**: A special MATLAB object allowing runtime tuning of block values post-compilation
- **Usage**: Generated by the `setupParams` function. Direct modifications affect simulation behavior but may not update signal characteristics for compilation or runtime tuning
**[Simulink Locations Where SimPar is Used in BAM](./SimPar/BAMSimPar.md )**

#### Requirements
- Use the `setParams` function to modify parameters safely

[Back..](../README.md#api-documentation)
